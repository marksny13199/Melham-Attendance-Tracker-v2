<?phpdate_default_timezone_set('Asia/Manila');require_once('smtp_validateEmail.class.php');        	    include("db/dbconnection.php");               $app_id = $conn->real_escape_string($_POST['app_id']);                $school = $conn->real_escape_string($_POST['school_name']);                 $firstname = $conn->real_escape_string($_POST['firstname']);                $middle_name = $conn->real_escape_string($_POST['middle_name']);                $lastname = $conn->real_escape_string($_POST['lastname']);                $street = $conn->real_escape_string($_POST['street']);                $barangay = $conn->real_escape_string($_POST['barangay']);                $city = $conn->real_escape_string($_POST['city']);                $province = $conn->real_escape_string($_POST['province']);                $birthdate = $conn->real_escape_string($_POST['birthdate']);                $religion = $conn->real_escape_string($_POST['religion']);                $sex = $conn->real_escape_string($_POST['sex']);                $civil_status = $conn->real_escape_string($_POST['civil_status']);                $email321321 = $conn->real_escape_string($_POST['email']);        $email = trim($email321321);                $company = $conn->real_escape_string($_POST['company']);                $department = $conn->real_escape_string($_POST['department']);                $currentDate = date('Y-m-d');        $currentTime = date('H:i');        $date = date('F j, Y', strtotime($currentDate)) ." at ".date('g:i A', strtotime($currentTime)); 		$start_date = $_POST['start_date'];		$estimated_end_date = $_POST['estimated_end_date'];		$required_hours = $_POST['required_hours'];		$gdrive_link = $_POST['gdrive_link'];		$mobile_no = $_POST['phone'];        $start_shift = $_POST['start_shift'];		$end_shift = $_POST['end_shift'];		$permission = 0;		$position = 0;        $intern_status = 'Unassigned';		$usertype = 'Intern';		$password = randomPass();		$hashed_pass = md5($password);				$schedule_daily = $_POST['schedule'];			        $profile_pic = $_FILES['profile_pic']['name'];                        $sender = "uip.tracker.v2@gmail.com";                $SMTP_Validator = new SMTP_validateEmail();        $results = $SMTP_Validator->validate(array($email), $sender);        $email_validate = ($results[$email] ? 'valid' : 'invalid');                        if($email === "invalid")        {            die("3");        }            $check_app_id = mysqli_query($conn, "SELECT app_id FROM intern_info where app_id = '$app_id'");        if(mysqli_num_rows($check_app_id) > 0){                    die("4");                }        if($start_shift == "8:00 AM"){            $shift = "1";                    }else if($start_shift == "9:00 AM"){            $shift = "2";                    }else{            $shift = "3";        }		$randomno = rand(0,100000);		$renames = 'upload'.$randomno;				$newName1= $renames.$profile_pic;		        $newName = $conn->real_escape_string($newName1); 		$target_dir = "uploaded_profile/";		$target_file = $target_dir.$newName;					$imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));        $extensions_arr = array("jpg","jpeg","png","gif");                if( in_array($imageFileType,$extensions_arr) ){         compressImage($_FILES["profile_pic"]["tmp_name"], $target_file, 30);		    $link = mysqli_real_escape_string( $gdrive_link); 					$sql = "SELECT * FROM user_acc WHERE username='".$email."'";			$result = $conn->query($sql);						if(mysqli_num_rows($result)!=0)			{				echo '2';			}			else			{				$sql1 = "INSERT INTO user_acc (shift, firstname, lastname, middle_name, username, passwd, usertype, position, permission, profile_pic, date_registered) VALUES ('$shift','$firstname', '$lastname', '$middle_name', '$email', '$hashed_pass', '$usertype', '$position', '$permission','$newName','$date')";				if ($conn->query($sql1) === TRUE) 				{					$sql2 = "INSERT INTO intern_info (schedule, school,mobile_no, username, app_id, street, barangay, city, province, birthdate, sex, religion, civil_status, company, department, intern_status, startdate,  required_hours, gdrive_link, estimated_end_date, start_shift, end_shift) VALUES ('$schedule_daily','$school','$mobile_no','$email', '$app_id', '$street', '$barangay', '$city', '$province', '$birthdate', '$sex', '$religion', '$civil_status', '$company', '$department', '$intern_status', '$start_date', '$required_hours', '$gdrive_link', '$estimated_end_date', '$start_shift', '$end_shift')";					if ($conn->query($sql2) === TRUE) 					{						$name = $firstname;  	                    require_once __DIR__.'/vendor/autoload.php';                        include("smtpInjection.php");		                    $mail = new \PHPMailer\PHPMailer\PHPMailer(true);                                                $mail->SMTPDebug = 0;                        $mail->isSMTP();                        $mail->Host = 'smtp.gmail.com';                        $mail->Port = 587;                        $mail->SMTPAuth = true;                        $mail->SMTPSecure = 'tls';                                               $mail->Username = $smtpEmail;                        $mail->Password = $smtpPass;                        // Recipients                        $mail->setFrom($smtpEmail, 'Melham Construction Corporation');                        $mail->addAddress($email,$name);	                    $mail->addReplyTo($smtpEmail,'Melham Construction Corporation');                        $mail->AddEmbeddedImage('imageMail/welcome.png', 'banner');	                    //message			                    $mail->isHTML(true);		                    $message = "<div style='border-left-width: 7px; border-left-style: solid; border-left-color: #0071BD; background-color: #d4dbd5; border-radius: 5px; width:650px;'><h4><b><p style='padding:15px 10px 15px 10px;'>Hello ".$firstname.",<br><br>Thank you for choosing Melham Construction Corporation Company. Please wait for your approval as we are checking your documents and check the spam folder from time to time thank you. Have a great day ahead!<br><br>Project IT-30 Team</p></b></h4></div>";	                        // Content                        $mail->Subject = "WAITING FOR APPROVAL";                        $mail->Body    = '<img style="height:300px; width:650px" alt="Loading image..." src="cid:banner">'.$message.'<br><br><br><footer><div style="text-align: center; font-size: 12px;color:black; height:30px; width: 100%;"><p>Copyright &copy; '.date("Y").' Melham Construction Corporation | Project IT-30 Team</p></div></footer>';                        $mail->send();												echo "1";					} else 					{						echo "0";					}										} else 				{					echo "0";				}	 			}        }else 		{			echo "0";		}                $conn->close();    function randomPass(){    $length = rand(10,20);    $randomCharacters = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789';    $stringLength = strlen($randomCharacters);    $randomString = '';    for ($i = 0; $i < $length; $i++) {        $randomString .= $randomCharacters[rand(0, $stringLength - 1)];    }    return $randomString;}		function compressImage($source, $destination, $quality) {			$info = getimagesize($source);				if ($info['mime'] == 'image/jpeg') {				$image = imagecreatefromjpeg($source);			} elseif ($info['mime'] == 'image/gif') {				$image = imagecreatefromgif($source);			} elseif ($info['mime'] == 'image/png') {				$image = imagecreatefrompng($source);			}				imagejpeg($image, $destination, $quality);			}	?>